{% extends "platformTK/SuperAdmin/HomeBase.html" %}
{% load static %}
{% load custom_filters %}

{% block content %}
{% include 'platformTK/SuperAdmin/navbar.html' %}
<title>Participation and Discipline</title>

<div class="container">
    <!-- Button to trigger modal for Group selection -->
    <button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#groupModal">
        Select Group and View History
    </button>

    <!-- Button to trigger modal for User selection -->
    <button type="button" class="btn btn-secondary mt-3" data-toggle="modal" data-target="#userModal">
        Select User and View History
    </button>

    <a href="{% url "participation_discipline" %}"><button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#userModal">
        back
    </button></a>

    <!-- Group Selection Modal -->
    <div class="modal fade" id="groupModal" tabindex="-1" role="dialog" aria-labelledby="groupModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="groupModalLabel">Select a Group</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post">
                        {% csrf_token %}
                        <label for="group_id">Choose a Group:</label>
                        <select name="group_id" id="group_id" class="form-control">
                            <option value="all">All Groups</option>
                            {% for group in groups %}
                                <option value="{{ group.id }}">{{ group.name }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary mt-3">Show Participation and Discipline</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Selection Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">Select a User</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="{% url 'participation_discipline' %}">
                        {% csrf_token %}
                        <label for="user_id">Choose a User:</label>
                        <select name="user_id" id="user_id" class="form-control">
                            {% for student in students_list %}
                                <option value="{{ student.id }}">{{ student.prenom|capitalize_first  }} {{ student.nom|capitalize_first  }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-secondary mt-3">Show History for User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Display Participation and Discipline Table -->
    {% if students %}
        <h2 class="mt-4">Participation and Discipline History for {{ selected_group_name }}</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Group</th>
                    <th>Participation</th>
                    <th>Discipline</th>
                    <th>Solde (Balance)</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ student.student.prenom|capitalize_first  }} {{ student.student.nom|capitalize_first  }}</td>
                    <td>{{ student.group }}</td>
                    <td>{{ student.participation }}</td>
                    <td>{{ student.discipline }}</td>
                    <td>{{ student.balance }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No students found. Please select a group or user to display the history.</p>
    {% endif %}
</div>

<!-- Include Bootstrap and jQuery for modal functionality -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
{% endblock %}
