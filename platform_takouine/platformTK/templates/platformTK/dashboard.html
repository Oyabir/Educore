{% load static  %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90680653-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-90680653-2');
    </script>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="Responsive Bootstrap 4 Dashboard Template">
    <meta name="author" content="BootstrapDash">

    <title>Dashboard Platform Takouine</title>

    <!-- vendor css -->
    <link href="{% static 'dashboard/lib/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
    <link href="{% static 'dashboard/lib/ionicons/css/ionicons.min.css' %}" rel="stylesheet">
    <link href="{% static 'dashboard/lib/typicons.font/typicons.css' %}" rel="stylesheet">
    <link href="{% static 'dashboard/lib/flag-icon-css/css/flag-icon.min.css' %}" rel="stylesheet">

    <!-- azia CSS -->
    <link rel="stylesheet" href="{% static 'dashboard/css/azia.css' %}">

  </head>
  <body>

    <div class="az-header">
      <div class="container">
        <div class="az-header-left">
          <a href="{% url "add_groupe" %}" class="az-logo"><span></span> Dashboard</a>
          <a href="" id="azMenuShow" class="az-header-menu-icon d-lg-none"><span></span></a>
        </div><!-- az-header-left -->
        <div class="az-header-menu">
          <div class="az-header-menu-header">
            <a href="{% url "add_groupe" %}" class="az-logo"><span></span> Dashboard</a>
            <a href="" class="close">&times;</a>
          </div><!-- az-header-menu-header -->
          {% comment %} <ul class="nav">
            <li class="nav-item active show">
              <a href="index.html" class="nav-link"><i class="typcn typcn-chart-area-outline"></i> Dashboard</a>
            </li>
            <li class="nav-item">
              <a href="" class="nav-link with-sub"><i class="typcn typcn-document"></i> Pages</a>
              <nav class="az-menu-sub">
                <a href="page-signin.html" class="nav-link">Sign In</a>
                <a href="page-signup.html" class="nav-link">Sign Up</a>
              </nav>
            </li>
            <li class="nav-item">
              <a href="chart-chartjs.html" class="nav-link"><i class="typcn typcn-chart-bar-outline"></i> Charts</a>
            </li>
            <li class="nav-item">
              <a href="form-elements.html" class="nav-link"><i class="typcn typcn-chart-bar-outline"></i> Forms</a>
            </li>
            <li class="nav-item">
              <a href="" class="nav-link with-sub"><i class="typcn typcn-book"></i> Components</a>
              <div class="az-menu-sub">
                <div class="container">
                  <div>
                    <nav class="nav">
                      <a href="elem-buttons.html" class="nav-link">Buttons</a>
                      <a href="elem-dropdown.html" class="nav-link">Dropdown</a>
                      <a href="elem-icons.html" class="nav-link">Icons</a>
                      <a href="table-basic.html" class="nav-link">Table</a>
                    </nav>
                  </div>
                </div><!-- container -->
              </div>
            </li>
          </ul> {% endcomment %}
        </div><!-- az-header-menu -->
        <div class="az-header-right">
          {% comment %} <a href="https://www.bootstrapdash.com/demo/azia-free/docs/documentation.html" target="_blank" class="az-header-search-link"><i class="far fa-file-alt"></i></a>
          <a href="" class="az-header-search-link"><i class="fas fa-search"></i></a>
          <div class="az-header-message">
            <a href="#"><i class="typcn typcn-messages"></i></a>
          </div><!-- az-header-message -->
          <div class="dropdown az-header-notification">
            <a href="" class="new"><i class="typcn typcn-bell"></i></a>
            <div class="dropdown-menu">
              <div class="az-dropdown-header mg-b-20 d-sm-none">
                <a href="" class="az-header-arrow"><i class="icon ion-md-arrow-back"></i></a>
              </div>
              <h6 class="az-notification-title">Notifications</h6>
              <p class="az-notification-text">You have 2 unread notification</p>
              <div class="az-notification-list">
                <div class="media new">
                  <div class="az-img-user"><img src="../img/faces/face2.jpg" alt=""></div>
                  <div class="media-body">
                    <p>Congratulate <strong>Socrates Itumay</strong> for work anniversaries</p>
                    <span>Mar 15 12:32pm</span>
                  </div><!-- media-body -->
                </div><!-- media -->
                <div class="media new">
                  <div class="az-img-user online"><img src="../img/faces/face3.jpg" alt=""></div>
                  <div class="media-body">
                    <p><strong>Joyce Chua</strong> just created a new blog post</p>
                    <span>Mar 13 04:16am</span>
                  </div><!-- media-body -->
                </div><!-- media -->
                <div class="media">
                  <div class="az-img-user"><img src="../img/faces/face4.jpg" alt=""></div> 
                  <div class="media-body">
                    <p><strong>Althea Cabardo</strong> just created a new blog post</p>
                    <span>Mar 13 02:56am</span>
                  </div><!-- media-body -->
                </div><!-- media -->
                <div class="media">
                  <div class="az-img-user"><img src="../img/faces/face5.jpg" alt=""></div>
                  <div class="media-body">
                    <p><strong>Adrian Monino</strong> added new comment on your photo</p>
                    <span>Mar 12 10:40pm</span>
                  </div><!-- media-body -->
                </div><!-- media -->
              </div><!-- az-notification-list -->
              <div class="dropdown-footer"><a href="">View All Notifications</a></div>
            </div><!-- dropdown-menu -->
          </div><!-- az-header-notification -->
          <div class="dropdown az-profile-menu">
            <a href="" class="az-img-user"><img src="../img/faces/face1.jpg" alt=""></a>
            <div class="dropdown-menu">
              <div class="az-dropdown-header d-sm-none">
                <a href="" class="az-header-arrow"><i class="icon ion-md-arrow-back"></i></a>
              </div>
              <div class="az-header-profile">
                <div class="az-img-user">
                  <img src="../img/faces/face1.jpg" alt="">
                </div><!-- az-img-user -->
                <h6>Aziana Pechon</h6>
                <span>Premium Member</span>
              </div><!-- az-header-profile -->

              <a href="" class="dropdown-item"><i class="typcn typcn-user-outline"></i> My Profile</a>
              <a href="" class="dropdown-item"><i class="typcn typcn-edit"></i> Edit Profile</a>
              <a href="" class="dropdown-item"><i class="typcn typcn-time"></i> Activity Logs</a>
              <a href="" class="dropdown-item"><i class="typcn typcn-cog-outline"></i> Account Settings</a>
              <a href="page-signin.html" class="dropdown-item"><i class="typcn typcn-power-outline"></i> Sign Out</a>
            </div><!-- dropdown-menu --> {% endcomment %}
          </div>
        </div><!-- az-header-right -->
      </div><!-- container -->
    </div><!-- az-header -->

    <div class="az-content az-content-dashboard">
      <div class="container">
        <div class="az-content-body">
          <div class="az-dashboard-one-title">
            <div>
              <h2 class="az-dashboard-title">Salut, bon retour !</h2>
              {% comment %} <p class="az-dashboard-text">Your web analytics dashboard template.</p> {% endcomment %}
            </div>
            <div class="az-content-header-right">
              {% comment %} <div class="media">
                <div class="media-body">
                  <label>Start Date</label>
                  <h6>Oct 10, 2018</h6>
                </div><!-- media-body -->
              </div><!-- media -->
              <div class="media">
                <div class="media-body">
                  <label>End Date</label>
                  <h6>Oct 23, 2018</h6>
                </div><!-- media-body -->
              </div><!-- media -->
              <div class="media">
                <div class="media-body">
                  <label>Event Category</label>
                  <h6>All Categories</h6>
                </div><!-- media-body -->
              </div><!-- media --> {% endcomment %}
              <a href="" class="btn btn-purple">Exporter</a>
            </div>
          </div><!-- az-dashboard-one-title -->

          <div class="az-dashboard-nav"> 
            <nav class="nav">
              {% comment %} <a class="nav-link active" data-toggle="tab" href="#">Overview</a>
              <a class="nav-link" data-toggle="tab" href="#">Audiences</a>
              <a class="nav-link" data-toggle="tab" href="#">Demographics</a>
              <a class="nav-link" data-toggle="tab" href="#">More</a> {% endcomment %}
            </nav>
            <nav class="nav">
              <a class="nav-link" href="#"><i class="far fa-save"></i> Sauvegarder le rapport</a>
              <a class="nav-link" href="#"><i class="far fa-file-pdf"></i> Exporter en PDF</a>
              {% comment %} <a class="nav-link" href="#"><i class="far fa-envelope"></i>Envoyer par email</a> {% endcomment %}
              <a class="nav-link" href="#"><i class="fas fa-ellipsis-h"></i></a>
          </nav>          
          </div>

          <div class="row row-sm mg-b-20">
            <div class="col-lg-7 ht-lg-100p">
              <div class="card card-dashboard-one">
                <div class="card-header">
                  <div>
                    <h6 class="card-title">Les Points par Groupes</h6>
                    {% comment %} <p class="card-text">Audience to which the users belonged while on the current date range.</p> {% endcomment %}
                  </div>
                  <div class="btn-group">
                    {% comment %} <button class="btn active">Day</button>
                    <button class="btn">Week</button>
                    <button class="btn">Month</button> {% endcomment %}
                  </div>
                </div><!-- card-header -->
                <div class="card-body">
                  <div class="card-body-top">
                    <div>
                      <label class="mg-b-0">Total des Groupes</label>
                      <h2>{{ total_groups }}</h2>
                  </div>
                  <div>
                      <label class="mg-b-0">Total des Points</label>
                      <h2>{{ total_points }}</h2>
                  </div>
                  <div>
                      <label class="mg-b-0">Moyenne des Points par Groupe</label>
                      <h2>{{ avg_points|floatformat:2 }}</h2>
                  </div>                  
                    {% comment %} <div>
                      <label class="mg-b-0">Sessions</label>
                      <h2>16,869</h2>
                    </div> {% endcomment %}
                  </div>
                  <br><br>
                  <!-- card-body-top -->
                 <!-- Your Flot Chart HTML Wrapper -->
                <div class="flot-chart-wrapper">
                    <div id="flotChart" class="flot-chart"></div>
                </div>
                </div><!-- card-body -->
              </div><!-- card -->
            </div><!-- col -->
            <div class="col-lg-5 mg-t-20 mg-lg-t-0">
              <div class="row row-sm">
                <div class="col-sm-6">
                  <div class="card card-dashboard-two">
                    <div class="card-header">
                        <h6>
                            {{ avg_competition_points|floatformat:2 }}  
                            {% if avg_competition_points > some_previous_value %}
                                <i class="icon ion-md-trending-up tx-success"></i>
                            {% elif avg_competition_points < some_previous_value %}
                                <i class="icon ion-md-trending-down tx-danger"></i>
                            {% else %}
                            <i class="icon ion-md-remove tx-warning"></i> <!-- When points are equal -->
                            {% endif %}
                            <small>{{ avg_competition_points|floatformat:2 }}%</small> 
                        </h6>
                        <p>Moyenne des Points pour les Compétitions</p>
                      </div><!-- card-header -->
                    <div class="card-body">
                      <div class="chart-wrapper">
                        <div id="flotChart1" class="flot-chart"></div>
                      </div><!-- chart-wrapper -->
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div><!-- col -->
                <div class="col-sm-6 mg-t-20 mg-sm-t-0">
                  <div class="card card-dashboard-two">
                    <div class="card-header">
                      <h6>
                        {{ avg_etudiant_points|floatformat:2 }} {% comment %} % {% endcomment %}
                        <!-- Check if the average points are greater than the previous average -->
                        {% if avg_etudiant_points > previous_avg_etudiant_points %}
                            <i class="icon ion-md-trending-up tx-success"></i> 
                        {% elif avg_etudiant_points < previous_avg_etudiant_points %}
                            <i class="icon ion-md-trending-down tx-danger"></i>
                        {% else %}
                            <i class="icon ion-md-remove tx-warning"></i> <!-- When points are equal -->
                        {% endif %}
                        
                        <small>{{ avg_etudiant_points|floatformat:2 }}%</small>  <!-- Display current average -->
                    </h6>
                    <p>Moyenne des Points pour les Étudiants</p>
                  </div><!-- card-header -->
                    <div class="card-body">
                      <div class="chart-wrapper">
                        <div id="flotChart2" class="flot-chart"></div>
                      </div><!-- chart-wrapper -->
                    </div><!-- card-body -->
                  </div><!-- card -->
                </div><!-- col -->
                <div class="col-sm-12 mg-t-20">
                  <div class="card card-dashboard-three">
                    <div class="card-header">
                      <p>Nombre Total de Commandes</p>
                      <h6>{{ total_orders }}</h6>
                      <small>Le nombre total de commandes effectuées dans le système.</small>
                    </div><!-- card-header -->
                    <div class="card-body">
                      <div class="chart"><canvas id="chartBar5"></canvas></div>
                    </div>
                  </div>
                </div>
              </div><!-- row -->
            </div><!--col -->
          </div><!-- row -->

          <div class="row row-sm mg-b-20">
            <div class="col-lg-4">
              <div class="card card-dashboard-pageviews">
                <div class="card-header">
                  <h6 class="card-title">Les 10 meilleurs étudiants</h6>
                  {% comment %} <p class="card-text">This report is based on 100% of sessions.</p> {% endcomment %}
                </div><!-- card-header -->
                <div class="card-body">{% for student in top_etudiant_data %}
                  <div class="az-list-item">
                    
                    <div>
                      <h6>{{ student.name|capitalize_first }}</h6>
                      {% comment %} <span>/demo/admin/index.html</span> {% endcomment %}
                    </div>
                    <div>
                      <h6 class="tx-primary">{{ student.points }}</h6>
                      <span>Points moyens {{ avg_etudiant_points|floatformat:2 }}%</span>
                    </div>
                  </div><!-- list-group-item -->
                  {% endfor %}
                </div><!-- card-body -->
              </div><!-- card -->

            </div><!-- col -->
            <div class="col-lg-8 mg-t-20 mg-lg-t-0">
              <div class="card card-dashboard-four">
                <div class="card-header">
                  <h6 class="card-title">Commandé</h6>
                </div><!-- card-header -->
                <div class="card-body row">
                  <div class="col-md-6 d-flex align-items-center" style="flex: 0 0 0; max-width: 100%">
                    <canvas id="chartDonut" style="width: 350px; height: 350px;"></canvas>
                  </div><!-- col -->
               <!-- Existing Code -->
               <div class="col-md-6 col-lg-5 mg-lg-l-auto mg-t-20 mg-md-t-0">
                <h2>Top 4 Produits par Quantité Commandée</h2>
                {% for product in top_product_data %}
                <div class="az-traffic-detail-item">
                    <div>
                        <span>{{ product.name }}</span>
                        <span>{{ product.total_quantity }} <span>({{ product.total_quantity|floatformat:0 }}%)</span></span>
                    </div>
                    <div class="progress">
                        {% if total_quantity %}
                        <div class="progress-bar bg-purple" role="progressbar" style="width: {{ product.total_quantity|floatformat:2 }}%;" aria-valuenow="{{ product.total_quantity }}" aria-valuemin="0" aria-valuemax="{{ total_quantity }}"></div>
                        {% else %}
                        <div class="progress-bar bg-purple" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="1"></div>
                        {% endif %}
                    </div><!-- progress -->
                </div>
                {% empty %}
                <div class="az-traffic-detail-item">
                  <div>Aucun produit vedette disponible</div>
                </div>
                {% endfor %}
              </div><!-- col -->            
                </div><!-- card-body -->
              </div><!-- card-dashboard-four -->
            </div><!-- col -->
          </div><!-- row -->

         
  <!-- Add Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          var ctxDoughnut = document.getElementById('chartDonut').getContext('2d');
          var chartData = JSON.parse('{{ chart_data|escapejs }}');

          var myDoughnutChart = new Chart(ctxDoughnut, {
              type: 'doughnut',
              data: {
                  labels: chartData.labels,
                  datasets: [{
                      data: chartData.data,
                      backgroundColor: ['#ff6384', '#36a2eb', '#cc65fe'],  // Custom colors for the segments
                      borderColor: '#fff',
                      borderWidth: 1
                  }]
              },
              options: {
                  responsive: true,
                  plugins: {
                      legend: {
                          position: 'top',
                      },
                      tooltip: {
                          callbacks: {
                              label: function(tooltipItem) {
                                  return tooltipItem.label + ': ' + tooltipItem.raw;
                              }
                          }
                      }
                  }
              }
          });
      });
  </script>

          <div class="row row-sm mg-b-20 mg-lg-b-0">
            <div class="col-lg-5 col-xl-4">
              <div class="row row-sm">
                <div class="col-md-6 col-lg-12 mg-b-20 mg-md-b-0 mg-lg-b-20">
                  {% comment %} <div class="card card-dashboard-five">
                    <div class="card-header">
                      <h6 class="card-title">Acquisition</h6>
                      <span class="card-text">Tells you where your visitors originated from, such as search engines, social networks or website referrals.</span>
                    </div><!-- card-header -->
                    <div class="card-body row row-sm">
                      <div class="col-6 d-sm-flex align-items-center">
                        <div class="card-chart bg-primary">
                          <span class="peity-bar" data-peity='{"fill": ["#fff"], "width": 20, "height": 20 }'>6,4,7,5,7</span>
                        </div>
                        <div>
                          <label>Bounce Rate</label>
                          <h4>33.50%</h4>
                        </div>
                      </div><!-- col -->
                      <div class="col-6 d-sm-flex align-items-center">
                        <div class="card-chart bg-purple">
                          <span class="peity-bar" data-peity='{"fill": ["#fff"], "width": 21, "height": 20 }'>7,4,5,7,2</span>
                        </div>
                        <div>
                          <label>Sessions</label>
                          <h4>9,065</h4>
                        </div>
                      </div><!-- col -->
                    </div><!-- card-body -->
                  </div><!-- card-dashboard-five --> {% endcomment %}
                </div><!-- col -->
                {% comment %} <div class="col-md-6 col-lg-12">
                  <div class="card card-dashboard-five">
                    <div class="card-header">
                      <h6 class="card-title">Sessions</h6>
                      <span class="card-text"> A session is the period time a user is actively engaged with your website, app, etc.</span>
                    </div><!-- card-header -->
                    <div class="card-body row row-sm">
                      <div class="col-6 d-sm-flex align-items-center">
                        <div class="mg-b-10 mg-sm-b-0 mg-sm-r-10">
                          <span class="peity-donut" data-peity='{ "fill": ["#007bff", "#cad0e8"],  "innerRadius": 14, "radius": 20 }'>4/7</span>
                        </div>
                        <div>
                          <label>% New Sessions</label>
                          <h4>26.80%</h4>
                        </div>
                      </div><!-- col -->
                      <div class="col-6 d-sm-flex align-items-center">
                        <div class="mg-b-10 mg-sm-b-0 mg-sm-r-10">
                          <span class="peity-donut" data-peity='{ "fill": ["#00cccc", "#cad0e8"],  "innerRadius": 14, "radius": 20 }'>2/7</span>
                        </div>
                        <div>
                          <label>Pages/Session</label>
                          <h4>1,005</h4>
                        </div>
                      </div><!-- col -->
                    </div><!-- card-body -->
                  </div><!-- card-dashboard-five -->
                </div><!-- col --> {% endcomment %}
              </div><!-- row -->
            </div><!-- col-lg-3 -->
            <div class="col-lg-7 col-xl-8 mg-t-20 mg-lg-t-0">
              <div class="card card-table-one">
                <h6 class="card-title">Top 4 Professeurs par Points</h6>
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Professeur</th>
                        <th>Total des Points</th>
                      </tr>                    
                    </thead>
                    <tbody>
                      {% for prof in top_prof_data %}
                      <tr>
                        <td><strong>{{ prof.name|capitalize_first }}</strong></td>
                        <td>{{ prof.points }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div><!-- table-responsive -->
              </div><!-- card -->
            </div><!-- col-lg -->
            

          </div><!-- row -->
        </div><!-- az-content-body -->
      </div>
    </div><!-- az-content -->

    <div class="az-footer ht-40">
      <div class="container ht-100p pd-t-0-f">
        <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Created By © Altivax 2024</span>
        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> All Right Reserved. <a href="https://altivax.com/" target="_blank">Altivax</a></span>
      </div><!-- container -->
    </div><!-- az-footer -->


    <script src="{% static 'dashboard/lib/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'dashboard/lib/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'dashboard/lib/ionicons/ionicons.js' %}"></script>
    <script src="{% static 'dashboard/lib/jquery.flot/jquery.flot.js' %}"></script>
    <script src="{% static 'dashboard/lib/jquery.flot/jquery.flot.resize.js' %}"></script>
    <script src="{% static 'dashboard/lib/chart.js/Chart.bundle.min.js' %}"></script>
    <script src="{% static 'dashboard/lib/peity/jquery.peity.min.js' %}"></script>

    <script src="{% static 'dashboard/js/azia.js' %}"></script>
    <script src="{% static 'dashboard/js/chart.flot.sampledata.js' %}"></script>
    <script src="{% static 'dashboard/js/dashboard.sampledata.js' %}"></script>
    <script src="{% static 'dashboard/js/jquery.cookie.js' %}" type="text/javascript"></script>
    <script>
        var groupPoints = {{ group_data|safe }};
    </script>
    
    <script>
      $(function(){
          'use strict';
  
          // Extract group names and points from the Django data
          var groupNames = groupPoints.map(group => group.name);
          var groupPointsData = groupPoints.map(group => group.points);
  
          // Modify the Flot chart data to reflect points per group as a Bar chart with Gradient
          var plot = $.plot('#flotChart', [{
              data: groupPointsData.map((points, index) => [index, points]),  // Map points to x,y coordinates
              bars: {
                  show: true,
                  barWidth: 0.5,  // Adjust bar width for spacing
                  align: 'center',
                  fillColor: {
                      colors: [
                          { opacity: 1, color: "#007bff" },   // Start of gradient (lighter red)
                          { opacity: 0.8, color: "#0056b3" }  // End of gradient (darker red)
                      ]
                  },
                  lineWidth: 1,  // Optional: Add border to bars
                  borderColor: '#900c3f'  // Optional: Set border color for bars
              }
          }], {
              series: {
                  shadowSize: 0
              },
              grid: {
                  borderWidth: 0,
                  labelMargin: 8
              },
              yaxis: {
                  show: true,
                  min: 0,
                  max: Math.max(...groupPointsData) + 20,  // Create space above the highest point
                  ticks: [[0, ''], [20, '20 Points'], [40, '40 Points'], [60, '60 Points'], [80, '80 Points'], [Math.max(...groupPointsData) + 20, '']],  // Add a tick for the maximum value
                  tickColor: '#eee'
              },
              xaxis: {
                  show: true,
                  ticks: groupNames.map((name, index) => [index, name]),  // Label each tick with the group name
                  color: '#fff',
                  tickLength: 0  // Removes tick lines on x-axis
              }
          });
      });
  </script>
  

    
  </body>
</html>
